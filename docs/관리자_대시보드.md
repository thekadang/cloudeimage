# 관리자 대시보드 설계

> **목적**: SaaS 서비스 운영을 위한 웹 기반 관리자 대시보드
> **대상 사용자**: 서비스 운영자, 관리자
> **최종 업데이트**: 2025-10-23
> **관련 Task**: Task 19

## 📁 관련 코드 위치

이 문서는 다음 구현을 위한 가이드입니다:
- **admin-dashboard/** (별도 프로젝트) - React 기반 웹 대시보드
- **src/auth/api_client.py** - 관리자 API 호출 (필요시)
- **AWS Lambda functions** - 관리자 전용 API 엔드포인트

**규칙**:
- 관리자 대시보드는 별도 웹 애플리케이션으로 개발
- 데스크톱 앱(src/)과는 분리된 프로젝트
- 관리자 인증은 별도 시스템 (높은 보안)

---

## 🎯 개요

### 관리자 대시보드란?

이미지 변환기 SaaS 서비스를 운영하기 위한 **웹 기반 관리 도구**입니다. 서비스 운영자가 회원을 관리하고, 통계를 모니터링하며, 수익을 분석하고, 수동으로 권한을 부여할 수 있습니다.

### 핵심 가치

1. **효율적 회원 관리**
   - 모든 회원 정보를 한눈에 파악
   - 수동 권한 부여로 프로모션/이벤트 지원
   - 문제 회원 신속 대응

2. **데이터 기반 의사결정**
   - 실시간 통계로 서비스 상태 파악
   - 수익 추이로 비즈니스 성과 측정
   - 사용 패턴 분석으로 개선 방향 도출

3. **시스템 안정성**
   - 서버 상태 모니터링
   - 에러 로그 추적
   - 비용 관리

---

## 🎨 주요 기능

### 1. 회원 관리 (User Management)

#### 1.1 회원 목록
**화면 구성**:
```
┌─────────────────────────────────────────────────────────┐
│ 회원 관리                                    [검색: ___] │
├─────────────────────────────────────────────────────────┤
│ ID │ 이메일 │ 플랜 │ 가입일 │ 마지막 로그인 │ 상태 │ 액션 │
├─────────────────────────────────────────────────────────┤
│ 1  │ user@example.com │ Pro │ 2025-01-10 │ 2025-10-23 │ 활성 │ [상세] │
│ 2  │ test@example.com │ Basic │ 2025-02-15 │ 2025-10-20 │ 활성 │ [상세] │
│ 3  │ demo@example.com │ Free │ 2025-03-01 │ 2025-09-30 │ 비활성 │ [상세] │
└─────────────────────────────────────────────────────────┘
```

**기능**:
- 전체 회원 목록 조회 (페이징 지원)
- 회원 검색 (이메일, 사용자 ID, 플랜)
- 정렬 (가입일, 마지막 로그인, 플랜)
- 필터링 (플랜별, 상태별)

#### 1.2 회원 상세 정보
**화면 구성**:
```
┌─────────────────────────────────────────────┐
│ 회원 상세 정보                               │
├─────────────────────────────────────────────┤
│ 📧 이메일: user@example.com                 │
│ 🆔 사용자 ID: user_12345                    │
│ 📅 가입일: 2025-01-10 14:30:00              │
│ 🔑 현재 플랜: Pro (만료: 2025-11-23)        │
│ 💻 하드웨어 ID: abc123def456                │
│ 🔄 마지막 로그인: 2025-10-23 09:15:00       │
│                                             │
│ 사용 통계:                                   │
│ - 오늘 변환: 15개                           │
│ - 이번 달 변환: 245개                       │
│ - 총 변환: 1,234개                          │
│                                             │
│ 결제 이력:                                   │
│ - 2025-10-01: Pro 플랜 결제 (9,900원)      │
│ - 2025-09-01: Pro 플랜 결제 (9,900원)      │
│                                             │
│ [플랜 변경] [권한 부여] [회원 정지] [삭제]    │
└─────────────────────────────────────────────┘
```

**기능**:
- 회원 기본 정보 조회
- 구독 이력 확인
- 사용량 통계
- 결제 내역

#### 1.3 수동 권한 부여 ⭐ **핵심 기능**

**목적**: 관리자가 특정 회원에게 무료로 플랜을 제공하거나 할인 혜택 제공

**사용 시나리오**:
- 프로모션 이벤트 당첨자에게 무료 Pro 플랜 제공
- VIP 고객에게 평생 무료 이용권 부여
- 베타 테스터에게 임시 Pro 권한 제공
- 기술 지원팀/파트너에게 무료 계정 제공

**화면 구성**:
```
┌─────────────────────────────────────────────┐
│ 수동 권한 부여                               │
├─────────────────────────────────────────────┤
│ 회원: user@example.com (user_12345)        │
│                                             │
│ 현재 플랜: Free                             │
│                                             │
│ 변경할 플랜: [● Pro  ○ Basic  ○ Free]      │
│                                             │
│ 권한 유형:                                   │
│ ○ 기간 제한 (만료일: [2025-12-31] 선택)     │
│ ● 영구 권한 (만료 없음)                     │
│                                             │
│ 사유: [___프로모션 이벤트 당첨자___]         │
│                                             │
│ ⚠️ 주의: 수동 권한은 결제 없이 부여됩니다    │
│                                             │
│ [취소] [권한 부여]                           │
└─────────────────────────────────────────────┘
```

**API 명세**:
```http
PATCH /admin/users/:userId/grant-access
Authorization: Bearer <admin_token>

{
  "plan": "pro",
  "expiry_type": "permanent",  // "permanent" or "temporary"
  "expiry_date": null,  // "2025-12-31T23:59:59Z" if temporary
  "reason": "프로모션 이벤트 당첨자",
  "granted_by": "admin_user_id"
}
```

**DynamoDB 저장**:
```json
{
  "user_id": "user_12345",
  "plan": "pro",
  "plan_type": "manual_grant",  // "paid" or "manual_grant"
  "expiry_date": null,
  "grant_reason": "프로모션 이벤트 당첨자",
  "granted_by": "admin_67890",
  "granted_at": "2025-10-23T10:00:00Z"
}
```

**기능**:
- 플랜 선택 (Free, Basic, Pro)
- 기간 선택 (영구 / 임시)
- 사유 입력 (필수)
- 권한 이력 추적

#### 1.4 회원 정지/복구
- 문제 회원 일시 정지
- 정지 사유 기록
- 정지 해제

---

### 2. 통계 대시보드 (Analytics)

#### 2.1 요약 통계
**화면 구성**:
```
┌─────────────────────────────────────────────────────────┐
│ 통계 대시보드                      [기간: 이번 달 ▼]     │
├─────────────────────────────────────────────────────────┤
│ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐   │
│ │ 전체 회원│ │ 유료 회원│ │ 월 수익  │ │ 활성 사용자│  │
│ │ 10,234   │ │ 6,140    │ │ 39.2M원 │ │ 8,456    │   │
│ │ ↑ 15%    │ │ ↑ 22%    │ │ ↑ 18%   │ │ ↑ 12%    │   │
│ └──────────┘ └──────────┘ └──────────┘ └──────────┘   │
└─────────────────────────────────────────────────────────┘
```

**표시 항목**:
- 전체 회원 수 (전월 대비 증가율)
- 유료 회원 수 (Free 제외)
- 월 수익 (MRR)
- 활성 사용자 (최근 7일 로그인)

#### 2.2 요금제별 가입자
**차트 구성**:
```
요금제별 가입자 분포

Pro (2,048명)    ████████████ 20%
Basic (4,092명)  ████████████████████████ 40%
Free (4,094명)   ████████████████████████ 40%
```

**기능**:
- 파이 차트 / 바 차트 전환
- 실시간 업데이트
- 클릭 시 해당 플랜 회원 목록으로 이동

#### 2.3 신규 가입자 추이
**그래프 구성**:
```
일일 신규 가입자 (최근 30일)

150┤           ╭─╮
   │       ╭───╯ ╰╮
100│   ╭───╯      ╰─╮
   │╭──╯            ╰──╮
 50├╯                  ╰──
   └────────────────────────
    1일  7일  14일  21일  30일
```

**기능**:
- 일별 / 주별 / 월별 전환
- 기간 선택 (1주, 1개월, 3개월, 1년)
- CSV 다운로드

#### 2.4 변환 사용량 통계
- 일일 총 변환 수
- 플랜별 평균 사용량
- 시간대별 사용 패턴

---

### 3. 수익 관리 (Revenue)

#### 3.1 월별 수익 현황
**표 구성**:
```
┌──────────────────────────────────────────────┐
│ 월별 수익 현황                                │
├──────────────────────────────────────────────┤
│ 월    │ 수익    │ 신규 결제│ 갱신  │ 환불  │
├──────────────────────────────────────────────┤
│ 10월  │ 39.2M원 │ 150건   │ 480건│ 5건  │
│ 09월  │ 33.1M원 │ 120건   │ 410건│ 3건  │
│ 08월  │ 28.5M원 │ 100건   │ 350건│ 4건  │
└──────────────────────────────────────────────┘
```

**기능**:
- 월별 수익 추이 그래프
- 신규 결제 / 갱신 구분
- 환불 내역
- 예상 MRR (Monthly Recurring Revenue)

#### 3.2 플랜별 수익 분포
**차트**:
```
플랜별 수익 기여도

Pro (19.8M원)   ████████████████████ 50.5%
Basic (19.4M원) ███████████████████ 49.5%
Free (0원)       0%
```

#### 3.3 결제 실패 내역
- 자동 결제 실패 목록
- 실패 사유 (카드 한도, 정보 오류 등)
- 재시도 상태

---

### 4. 시스템 모니터링 (System Monitoring)

#### 4.1 서버 상태
**구성**:
```
┌──────────────────────────────────────┐
│ AWS 서비스 상태                       │
├──────────────────────────────────────┤
│ ✅ Lambda Functions     정상 동작    │
│ ✅ API Gateway          정상 동작    │
│ ✅ DynamoDB            정상 동작     │
│ ⚠️  S3 Bucket          경고 (90% 사용)│
└──────────────────────────────────────┘
```

#### 4.2 API 호출 통계
- 시간당 API 호출 수
- 엔드포인트별 호출 빈도
- 평균 응답 시간
- 에러율

#### 4.3 에러 로그
**테이블**:
```
┌────────────────────────────────────────────────┐
│ 최근 에러 로그                                  │
├────────────────────────────────────────────────┤
│ 시간        │ API        │ 에러 코드 │ 메시지 │
├────────────────────────────────────────────────┤
│ 10:15:32   │ /auth/login│ 500      │ DB연결실패│
│ 09:42:18   │ /subscription│ 401   │ 토큰만료 │
└────────────────────────────────────────────────┘
```

#### 4.4 비용 현황
**월별 AWS 비용**:
```
┌──────────────────────────────────────┐
│ 이번 달 AWS 비용                      │
├──────────────────────────────────────┤
│ Lambda        ₩520                   │
│ API Gateway   ₩910                   │
│ DynamoDB      ₩0 (무료 티어)         │
│ S3            ₩1,200                 │
├──────────────────────────────────────┤
│ 총 비용       ₩2,630                 │
└──────────────────────────────────────┘
```

---

## 🏗️ 기술 스택

### 프론트엔드
- **프레임워크**: React 18.x
- **UI 라이브러리**: Ant Design 5.x
- **상태 관리**: Redux Toolkit / Zustand
- **차트**: Recharts / Chart.js
- **라우팅**: React Router v6
- **HTTP 클라이언트**: Axios
- **빌드**: Vite

### 백엔드 (관리자 API)
- **플랫폼**: AWS Lambda (Python 3.9)
- **API**: API Gateway (REST API)
- **데이터베이스**: DynamoDB
- **인증**: JWT (관리자 전용 토큰)
- **권한**: IAM Role (높은 권한)

### 배포
- **호스팅**: AWS S3 + CloudFront (정적 사이트)
- **도메인**: admin.imageconverter.com
- **SSL**: AWS Certificate Manager
- **CI/CD**: GitHub Actions

---

## 🔐 보안 및 권한 시스템

### 관리자 등급

| 등급 | 권한 | 설명 |
|------|------|------|
| **Super Admin** | 모든 권한 | 최고 관리자 (서비스 소유자) |
| **Admin** | 회원 관리, 통계 조회 | 일반 관리자 |
| **Viewer** | 통계 조회만 | 읽기 전용 |

### 관리자 인증

**별도 JWT 시스템**:
```json
{
  "header": {
    "alg": "RS256",
    "typ": "JWT"
  },
  "payload": {
    "admin_id": "admin_12345",
    "email": "admin@imageconverter.com",
    "role": "super_admin",
    "permissions": ["users.read", "users.write", "stats.read", "revenue.read"],
    "exp": 1735689600,  // 1시간 후 만료
    "iat": 1735686000
  }
}
```

### 보안 조치

1. **IP 화이트리스트** (선택적)
   - 특정 IP에서만 관리자 페이지 접근 허용
   - AWS WAF 규칙 설정

2. **2단계 인증 (2FA)** (선택적)
   - OTP 인증 추가
   - Google Authenticator 연동

3. **활동 로그**
   - 모든 관리자 작업 기록
   - 회원 정보 수정, 권한 부여 등

4. **세션 관리**
   - 1시간 자동 로그아웃
   - 동시 로그인 제한

---

## 📱 화면 설계

### 메인 레이아웃
```
┌────────────────────────────────────────────────────────┐
│ [로고] 이미지 변환기 관리자             admin@example.com│
├────────────────────────────────────────────────────────┤
│ 📊 대시보드  │                                          │
│ 👥 회원 관리  │    메인 콘텐츠 영역                       │
│ 💰 수익 관리  │                                          │
│ 🔧 시스템    │                                          │
│ ⚙️ 설정      │                                          │
│ 🚪 로그아웃   │                                          │
└────────────────────────────────────────────────────────┘
```

### 주요 페이지 목록
1. `/admin` - 대시보드 (통계 요약)
2. `/admin/users` - 회원 목록
3. `/admin/users/:id` - 회원 상세
4. `/admin/revenue` - 수익 관리
5. `/admin/system` - 시스템 모니터링
6. `/admin/settings` - 관리자 설정
7. `/admin/logs` - 활동 로그

---

## 🔌 API 명세

### 관리자 인증 API

#### 로그인
```http
POST /admin/auth/login

{
  "email": "admin@imageconverter.com",
  "password": "secure_password",
  "otp_code": "123456"  // 2FA 활성화 시
}

Response:
{
  "access_token": "...",
  "refresh_token": "...",
  "admin": {
    "admin_id": "admin_12345",
    "email": "admin@imageconverter.com",
    "role": "super_admin"
  }
}
```

### 회원 관리 API

#### 1. 회원 목록 조회
```http
GET /admin/users?page=1&limit=50&plan=pro&status=active

Response:
{
  "users": [...],
  "total": 10234,
  "page": 1,
  "limit": 50
}
```

#### 2. 회원 상세 조회
```http
GET /admin/users/:userId

Response:
{
  "user_id": "user_12345",
  "email": "user@example.com",
  "plan": "pro",
  "created_at": "2025-01-10T14:30:00Z",
  "usage_stats": {...},
  "payment_history": [...]
}
```

#### 3. 수동 권한 부여 ⭐
```http
PATCH /admin/users/:userId/grant-access

{
  "plan": "pro",
  "expiry_type": "permanent",
  "expiry_date": null,
  "reason": "프로모션 이벤트 당첨자"
}

Response:
{
  "success": true,
  "message": "권한이 성공적으로 부여되었습니다",
  "user": {
    "user_id": "user_12345",
    "plan": "pro",
    "plan_type": "manual_grant",
    "granted_at": "2025-10-23T10:00:00Z"
  }
}
```

#### 4. 플랜 변경
```http
PATCH /admin/users/:userId/plan

{
  "new_plan": "basic",
  "reason": "사용자 요청"
}
```

#### 5. 회원 정지/복구
```http
PATCH /admin/users/:userId/status

{
  "status": "suspended",
  "reason": "약관 위반"
}
```

### 통계 API

#### 1. 대시보드 통계
```http
GET /admin/stats/dashboard?period=month

Response:
{
  "total_users": 10234,
  "paid_users": 6140,
  "monthly_revenue": 39200000,
  "active_users": 8456,
  "growth_rates": {...}
}
```

#### 2. 플랜별 가입자
```http
GET /admin/stats/users-by-plan

Response:
{
  "free": 4094,
  "basic": 4092,
  "pro": 2048
}
```

#### 3. 신규 가입자 추이
```http
GET /admin/stats/new-users?period=30days

Response:
{
  "dates": ["2025-10-01", "2025-10-02", ...],
  "counts": [45, 52, 38, ...]
}
```

### 수익 API

#### 1. 월별 수익
```http
GET /admin/revenue/monthly?months=12

Response:
{
  "months": ["2025-01", "2025-02", ...],
  "revenue": [28500000, 31200000, ...]
}
```

#### 2. 결제 내역
```http
GET /admin/revenue/transactions?page=1&limit=50

Response:
{
  "transactions": [...],
  "total": 5234
}
```

---

## 📊 DynamoDB 테이블 설계

### admins 테이블
```
Partition Key: admin_id
Sort Key: -

Attributes:
- admin_id: string (UUID)
- email: string
- password_hash: string (bcrypt)
- role: string (super_admin, admin, viewer)
- permissions: list<string>
- created_at: string (ISO 8601)
- last_login: string (ISO 8601)
- two_factor_enabled: boolean
- two_factor_secret: string (encrypted)
```

### admin_logs 테이블 (활동 로그)
```
Partition Key: admin_id
Sort Key: timestamp

Attributes:
- log_id: string (UUID)
- admin_id: string
- action: string (grant_access, change_plan, suspend_user)
- target_user_id: string
- details: map
- timestamp: string (ISO 8601)
- ip_address: string
```

### users 테이블 (기존 테이블에 추가)
```
추가 속성:
- plan_type: string (paid, manual_grant)
- grant_reason: string
- granted_by: string (admin_id)
- granted_at: string (ISO 8601)
```

### Global Secondary Index (GSI)
```
GSI: plan-index
Partition Key: plan
Sort Key: created_at

→ 플랜별 회원 조회 최적화
```

---

## 🚀 구현 계획

### Phase 1: 기본 인프라 (1주)
- [ ] React 프로젝트 생성
- [ ] Ant Design 설치 및 레이아웃 구성
- [ ] 관리자 인증 API (Lambda) 구현
- [ ] DynamoDB admins 테이블 생성
- [ ] 로그인 화면 구현

### Phase 2: 회원 관리 (2주)
- [ ] 회원 목록 API 구현
- [ ] 회원 목록 화면
- [ ] 회원 상세 화면
- [ ] 수동 권한 부여 API ⭐
- [ ] 수동 권한 부여 UI
- [ ] 플랜 변경 기능
- [ ] 회원 정지/복구 기능

### Phase 3: 통계 및 수익 (1주)
- [ ] 통계 API 구현
- [ ] 대시보드 화면 (차트)
- [ ] 수익 관리 API
- [ ] 수익 관리 화면

### Phase 4: 시스템 모니터링 (1주)
- [ ] CloudWatch 연동
- [ ] 에러 로그 수집 API
- [ ] 시스템 모니터링 화면
- [ ] 비용 추적 기능

### Phase 5: 배포 및 보안 (3일)
- [ ] S3 + CloudFront 배포
- [ ] SSL 인증서 설정
- [ ] IP 화이트리스트 (선택)
- [ ] 2FA 구현 (선택)
- [ ] 활동 로그 시스템

### Phase 6: 테스트 및 최적화 (2일)
- [ ] 통합 테스트
- [ ] 성능 최적화
- [ ] 보안 점검
- [ ] 문서화

**총 개발 기간**: 약 4주

---

## 💰 예상 비용

### 개발 비용
- 프론트엔드 개발: 2주
- 백엔드 API 개발: 2주
- 총 4주 개발 투입

### 운영 비용 (월별)
- **CloudFront**: ₩500-1,000 (트래픽 적음)
- **S3**: ₩100-300 (정적 파일 호스팅)
- **Lambda**: ₩0-500 (관리자 API 호출 적음)
- **DynamoDB**: ₩0 (무료 티어)

**총 운영 비용**: 약 ₩600-1,800/월

---

## ✅ 체크리스트

### 필수 기능
- [ ] 관리자 로그인
- [ ] 회원 목록 조회
- [ ] 수동 권한 부여 ⭐
- [ ] 요금제별 통계
- [ ] 월별 수익 현황

### 선택 기능
- [ ] IP 화이트리스트
- [ ] 2단계 인증
- [ ] 실시간 알림
- [ ] CSV 다운로드
- [ ] 고급 필터링

### 보안 검토
- [ ] JWT 토큰 보안
- [ ] SQL Injection 방지 (DynamoDB 사용으로 해당 없음)
- [ ] XSS 방지
- [ ] CSRF 방지
- [ ] 활동 로그

---

> **참조 문서**
> - [프로젝트_개요.md](./프로젝트_개요.md)
> - [서버_인증시스템.md](./서버_인증시스템.md)
> - [task.md](../task.md)

> **관련 Task**
> - Task 9: 서버리스 백엔드 구축
> - Task 19: 관리자 대시보드 구축 ⭐ 이 문서
